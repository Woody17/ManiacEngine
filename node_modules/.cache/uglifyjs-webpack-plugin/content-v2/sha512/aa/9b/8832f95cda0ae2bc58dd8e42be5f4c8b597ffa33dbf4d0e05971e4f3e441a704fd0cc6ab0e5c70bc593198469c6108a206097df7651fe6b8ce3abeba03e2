{"code":"var ManiacEngine=function(t){var i={};function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var r in t)e.d(n,r,function(i){return t[i]}.bind(null,r));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,\"a\",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p=\"\",e(e.s=0)}([function(t,i,e){\"use strict\";e.r(i);var n={canvasIdentifier:\"canvas\",colorDepth:30,lightDistanceThreshold:10,screenScale:2,disableClipping:!1,cameraNear:.1,cameraFar:1e3,cameraFOVDegrees:90},r={RoundToPixelGrid:(t,i)=>Math.round(t*i)/i,IsEmpty:t=>{for(var i in t)return!0;return!1}};class a{constructor(t,i,e){this.x=t,this.y=i,this.z=e,this.w=1}static Add(t,i){return new a(t.x+i.x,t.y+i.y,t.z+i.z)}static Subtract(t,i){return new a(t.x-i.x,t.y-i.y,t.z-i.z)}static Multiply(t,i){return new a(t.x*i,t.y*i,t.z*i)}static Divide(t,i){return new a(t.x/i,t.y/i,t.z/i)}static Dot(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}static Length(t){return Math.sqrt(a.Dot(t,t))}static Normalize(t){var i=a.Length(t);return new a(t.x/i,t.y/i,t.z/i)}static Cross(t,i){return new a(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)}static MultiplyWithMatrix(t,i){var e=new a(0,0,0);return e.x=t.x*i[0][0]+t.y*i[1][0]+t.z*i[2][0]+t.w*i[3][0],e.y=t.x*i[0][1]+t.y*i[1][1]+t.z*i[2][1]+t.w*i[3][1],e.z=t.x*i[0][2]+t.y*i[1][2]+t.z*i[2][2]+t.w*i[3][2],e.w=t.x*i[0][3]+t.y*i[1][3]+t.z*i[2][3]+t.w*i[3][3],e}static IntersectPlane(t,i,e,n){i=a.Normalize(i);var r=-a.Dot(i,t),s=a.Dot(e,i),o=(-r-s)/(a.Dot(n,i)-s),h=a.Subtract(n,e),l=a.Multiply(h,o);return a.Add(e,l)}static Print(t,i=\"Vector\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}pixelAlign(t){return this.x=r.RoundToPixelGrid(this.x,t),this.y=r.RoundToPixelGrid(this.y,t),this.z=r.RoundToPixelGrid(this.z,t),this}}class s{static Make(t){for(var i=[],e=0;e<t[0];++e)i.push(1==t.length?0:s.Make(t.slice(1)));return i}static Identity(){var t=s.Make([4,4]);return t[0][0]=1,t[1][1]=1,t[2][2]=1,t[3][3]=1,t}static Translation(t){var i=s.Identity();return i[3][0]=t.x,i[3][1]=t.y,i[3][2]=t.z,i}static Scale(t){var i=s.Identity();return i[0][0]=t.x,i[1][1]=t.y,i[2][2]=t.z,i}static RotationX(t){var i=s.Identity();return i[0][0]=1,i[1][1]=Math.cos(t),i[1][2]=Math.sin(t),i[2][1]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationY(t){var i=s.Identity();return i[0][0]=Math.cos(t),i[0][2]=Math.sin(t),i[1][1]=1,i[2][0]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationZ(t){var i=s.Identity();return i[0][0]=Math.cos(t),i[0][1]=Math.sin(t),i[1][0]=-Math.sin(t),i[1][1]=Math.cos(t),i[2][2]=1,i[3][3]=1,i}static Rotation(t){var i=s.Identity();return i=s.Multiply(i,s.RotationX(t.x)),i=s.Multiply(i,s.RotationY(t.y)),i=s.Multiply(i,s.RotationZ(t.z))}static Projection(t,i,e,n){var r=s.Identity();return r[0][0]=t*i,r[1][1]=i,r[2][2]=n/(n-e),r[3][2]=-n*e/(n-e),r[2][3]=1,r[3][3]=0,r}static Multiply(t,i){for(var e=s.Identity(),n=0;n<4;n++)for(var r=0;r<4;r++)e[r][n]=t[r][0]*i[0][n]+t[r][1]*i[1][n]+t[r][2]*i[2][n]+t[r][3]*i[3][n];return e}static Inverse(t){for(var i=s.Identity(),e=0;e<4;e++){var n=t[e][e];if(0==n){for(var r=e+1;r<dim;r+=1)if(0!=t[r][e]){for(a=0;a<4;a++)n=t[e][a],t[e][a]=t[r][a],t[r][a]=n,n=i[e][a],i[e][a]=i[r][a],i[r][a]=n;break}if(0==(n=t[e][e]))return s.Identity()}for(var a=0;a<4;a++)t[e][a]=t[e][a]/n,i[e][a]=i[e][a]/n;for(r=0;r<4;r++)if(r!=e){n=t[r][e];for(a=0;a<4;a++)t[r][a]-=n*t[e][a],i[r][a]-=n*i[e][a]}}return i}static LookAt(t,i,e){var n=a.Subtract(i,t);n=a.Normalize(n);var r=a.Multiply(n,a.Dot(e,n)),o=a.Subtract(e,r);o=a.Normalize(o);var h=a.Cross(o,n),l=s.Identity();return l[0][0]=h.x,l[0][1]=h.y,l[0][2]=h.z,l[0][3]=0,l[1][0]=o.x,l[1][1]=o.y,l[1][2]=o.z,l[1][3]=0,l[2][0]=n.x,l[2][1]=n.y,l[2][2]=n.z,l[2][3]=0,l[3][0]=t.x,l[3][1]=t.y,l[3][2]=t.z,l[3][3]=1,l}static Print(t,i=\"Matrix\"){console.log(i);for(var e=0;e<4;e++)for(var n=0;n<4;n++)console.log(\"[\"+e+\"][\"+n+\"] = \"+t[e][n])}}class o{static Print(t,i=\"Light\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}static ShadeForPercentage(t,i){return{x:255*t.x*i/255,y:255*t.y*i/255,z:255*t.z*i/255,w:1}}static Blend(t,i,e,n,r,a,s,o){function h(t,i,e){return parseInt(t*e+i*(1-e))}function l(t,i,e){return[h(t[0],i[0],e),h(t[1],i[1],e),h(t[2],i[2],e)]}var c={x:e.x,y:e.y,z:e.z,w:1};c=n[r];for(var u=0;u<t.length;u++){var d=t[u][i[u]],g=a[u],p=Vector.Length(Vector.Subtract(g,s));if(p<o){var v=p/o,x=l([255*c.x,255*c.y,255*c.z,1],[255*d.x,255*d.y,255*c.z,1],v);c={x:x[0]/255,y:x[1]/255,z:x[2]/255,w:1}}}return c}static GetShadingIndex(t,i){var e=Math.round((i-1)*t);return e>i-1&&(e=i-1),e<0&&(e=0),e}}var h={Cube:()=>[[[0,0,0],[0,1,0],[1,1,0]],[[0,0,0],[1,1,0],[1,0,0]],[[1,0,0],[1,1,0],[1,1,1]],[[1,0,0],[1,1,1],[1,0,1]],[[1,0,1],[1,1,1],[0,1,1]],[[1,0,1],[0,1,1],[0,0,1]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,1],[0,1,0],[0,0,0]],[[0,1,0],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[1,0,1],[0,0,1],[0,0,0]],[[1,0,1],[0,0,0],[1,0,0]]]};class l{constructor(t=h.Cube(),i=new a(0,0,5),e=new a(0,0,0),n=new a(1,1,1)){this.vertices=t,this.translation=i,this.rotation=e,this.scale=n}}class c{constructor(t,i,e,n,r){this.p0=t,this.p1=i,this.p2=e,this.colorIndices=n,this.ambientIndex=r}}class u{constructor(t,i,e,n,r,a){this.p0=t,this.p1=i,this.p2=e,this.p3=n,this.colorIndices=r,this.ambientIndex=a}}class d{constructor(t,i,e,n){this.isQuad=t,this.triangle=i,this.quad=e,this.positionForLightCalculation=n}averageZ(){return this.isQuad?(this.quad.p0.z+this.quad.p1.z+this.quad.p2.z+this.quad.p3.z)/4:(this.triangle.p0.z+this.triangle.p1.z+this.triangle.p2.z)/4}colorIndices(){return this.isQuad?this.quad.colorIndices:this.triangle.colorIndices}getAmbientIndex(){return this.isQuad?this.quad.ambientIndex:this.triangle.ambientIndex}worldPositionForLighting(){return this.positionForLightCalculation}colorIndex(t){return this.colorIndices()[t]}rawPoints(){return this.isQuad?[this.quad.p0,this.quad.p1,this.quad.p2,this.quad.p3]:[this.triangle.p0,this.triangle.p1,this.triangle.p2]}setRawPoints(t){var i=this.colorIndices(),e=(this.positionForLightCalculation,this.getAmbientIndex());3==t.length?(this.isQuad=!1,this.triangle=new c(t[0],t[1],t[2],i,e)):(this.isQuad=!0,this.quad=new u(t[0],t[1],t[2],t[3],i,e))}pixelAlign(t){this.isQuad?this.setRawPoints([this.quad.p0.pixelAlign(t),this.quad.p1.pixelAlign(t),this.quad.p2.pixelAlign(t),this.quad.p3.pixelAlign(t)]):this.setRawPoints([this.triangle.p0.pixelAlign(t),this.triangle.p1.pixelAlign(t),this.triangle.p2.pixelAlign(t)])}}var g={ClipVertices:(t,i,e)=>{function n(t,i,e){return e.x*t.x+e.y*t.y+e.z*t.z-a.Dot(e,i)}if(i=a.Normalize(i),0==e.length)return[];for(var r=[],s=!0,o=!0,h=[],l=[],c=0;c<e.length;c++){var u=e[c];n(u,t,i)>=0?(o=!1,r.push({inside:!0,point:u}),h.push(u)):(s=!1,r.push({inside:!1,point:u}),l.push(u))}return s?e:o?[]:(3==e.length&&1==l.length&&(e=[h[0],h[1],a.IntersectPlane(t,i,h[1],l[0]),a.IntersectPlane(t,i,h[0],l[0])]),3==e.length&&2==l.length&&(e=[h[0],a.IntersectPlane(t,i,h[0],l[0]),a.IntersectPlane(t,i,h[0],l[1])]),e)}};e.d(i,\"Engine\",function(){return p}),e.d(i,\"Model\",function(){return l}),e.d(i,\"Vector\",function(){return a});class p{constructor(t=n){this.settings=t,this.cameraNear=.1,this.cameraFar=1e3,this.cameraFOVDegrees=90,this.cameraFOV=1/Math.tan(.5*this.cameraFOVDegrees/180*3.14159),this.cameraAspectRatio=0,this.cameraPosition=new a(0,0,0),this.cameraRotation=0,this.lightColorTables=[],this.ambientLightColorTable=[],this.lightNormals=[],this.lightPositions=[],this.colorDepth=1,this.ambientLightVector,this.ambientLightNormal,this.screenSize,this.models=[]}run(t=(()=>[]),i=(()=>!1)){this.updateFn=t,this.endFn=i,this.canvas=document.getElementById(this.settings.canvasIdentifier),this.canvasContext=canvas.getContext(\"2d\"),requestAnimationFrame(this._mainEventLoop.bind(this))}_mainEventLoop(){this.endFn()||(this.models=this.updateFn(),this._update(),this._render(),requestAnimationFrame(this._mainEventLoop.bind(this)))}_update(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight;var t={width:this.canvas.width,height:this.canvas.height};function i(t,i){for(var e=[],n=0;n<i;n++){var r=n/i;e.push(o.ShadeForPercentage(t,r))}return e}this.cameraAspectRatio=t.height/t.width,this.cameraPosition=new a(0,-1,1),this.cameraRotation=0,this.cameraNear=this.settings.cameraNear,this.cameraFar=this.settings.cameraFar,this.cameraFOVDegrees=this.settings.cameraFOVDegrees,this.colorDepth=this.settings.colorDepth,this.lightColorTables=[],this.lightNormals=[],this.ambientLightVector=new a(1,0,0),this.ambientLightColorTable=i(this.ambientLightVector,this.colorDepth),this.ambientLightNormal=a.Normalize(new a(0,0,-1));for(var e=[],n=0;n<e.length;n++){var r=e[n],h=new a(r.color.X,r.color.Y,r.color.Z),l=new a(r.position.X,r.position.Y,r.position.Z);this.lightPositions.push(l),this.lightColorTables.push(i(h,this.colorDepth)),this.lightNormals.push(a.Normalize(l))}var p=[],v=new a(0,1,0),x=new a(0,0,1),y=s.RotationY(this.cameraRotation),m=a.MultiplyWithMatrix(x,y);x=a.Add(this.cameraPosition,m);var f=s.Inverse(s.LookAt(this.cameraPosition,x,v)),w=s.Projection(this.cameraAspectRatio,this.cameraFOV,this.cameraNear,this.cameraFar);for(n=0;n<this.models.length;n++){var z=this.models[n],b=s.Identity(),M=s.Rotation(z.rotation);b=s.Multiply(b,M);var I=s.Translation(z.translation);b=s.Multiply(b,I);var C=s.Scale(z.scale);b=s.Multiply(b,C);for(var P=0;P<z.vertices.length;++P){for(var D=[],S=z.vertices[P],T=0;T<S.length;T++){var F=new a(S[T][0],S[T][1],S[T][2]);F=a.MultiplyWithMatrix(F,b),D.push(F)}var L=[D];4==D.length&&(L=[[D[0],D[1],D[3]],[D[1],D[2],D[3]]]);for(var R=0;R<L.length;R++){D=L[R];var A=a.Subtract(D[1],D[0]),N=a.Subtract(D[2],D[0]),V=a.Normalize(a.Cross(A,N)),q=a.Subtract(D[0],this.cameraPosition);if(a.Dot(V,q)<0){for(var O=[],_=0;_<this.lightNormals.length;_++){var j=o.GetShadingIndex(a.Dot(V,this.lightNormals[_]));O.push(j)}var Q=o.GetShadingIndex(a.Dot(V,this.ambientLightNormal));if(!this.settings.disableClipping&&0==(D=g.ClipVertices(new a(0,0,.1),new a(0,0,1),D)).length)continue;var k=[],E=D[0];for(T=0;T<D.length;T++){var G=a.MultiplyWithMatrix(D[T],f);G=a.MultiplyWithMatrix(G,w),(G=a.Divide(G,G.w)).x+=1,G.x*=.5*t.width,G.y+=1,G.y*=.5*t.height,k.push(G),console.log(JSON.stringify(k))}4==D.length?p.push(new d(!0,{},new u(k[0],k[1],k[2],k[3],O,Q),E)):p.push(new d(!1,new c(k[0],k[1],k[2],O,Q),{},E))}}}}this.geometryToDraw=p,this.screenSize=t}_render(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.geometryToDraw.sort(function(t,i){return t.averageZ()<i.averageZ()});for(var t=0;t<this.geometryToDraw.length;t++){var i=this.geometryToDraw[t],e=i.rawPoints();if(this.settings.disableClipping||(e=g.ClipVertices(new a(0,0,0),new a(0,1,0),e),e=g.ClipVertices(new a(0,this.screenSize.height-1,0),new a(0,-1,0),e),e=g.ClipVertices(new a(0,0,0),new a(1,0,0),e),0!=(e=g.ClipVertices(new a(this.screenSize.width-1,0,0),new a(-1,0,0),e)).length)){i.setRawPoints(e),i.pixelAlign(this.settings.screenScale);var n=o.Blend(this.lightColorTables,i.colorIndices(),this.ambientLightVector,this.ambientLightColorTable,i.getAmbientIndex(),this.lightPositions,i.worldPositionForLighting(),this.settings.lightDistanceThreshold);if(n={x:1,y:0,z:0,w:1},this.canvasContext.fillStyle=\"rgba(\"+255*n.x+\", \"+255*n.y+\", \"+255*n.z+\", \"+n.w+\");\",i.isQuad){var r=i.quad;this.canvasContext.beginPath(),this.canvasContext.moveTo(r.p0.x,r.p0.y),this.canvasContext.lineTo(r.p1.x,r.p1.y),this.canvasContext.lineTo(r.p2.x,r.p2.y),this.canvasContext.lineTo(r.p3.x,r.p3.y),this.canvasContext.closePath(),this.canvasContext.stroke()}else{var s=i.triangle;this.canvasContext.beginPath(),this.canvasContext.moveTo(s.p0.x,s.p0.y),this.canvasContext.lineTo(s.p1.x,s.p1.y),this.canvasContext.lineTo(s.p2.x,s.p2.y),this.canvasContext.closePath(),this.canvasContext.stroke()}}}}}}]);","extractedComments":[]}