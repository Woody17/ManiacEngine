{"code":"var ManiacEngine=function(t){var i={};function e(r){if(i[r])return i[r].exports;var a=i[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var a in t)e.d(r,a,function(i){return t[i]}.bind(null,a));return r},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,\"a\",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p=\"\",e(e.s=0)}([function(t,i,e){\"use strict\";e.r(i);var r={canvasIdentifier:\"canvas\",colorDepth:30,lightDistanceThreshold:10,screenScale:2,disableClipping:!1,cameraNear:.1,cameraFar:1e3,cameraFOVDegrees:90},a={RoundToPixelGrid:(t,i)=>Math.round(t*i)/i,IsEmpty:t=>{for(var i in t)return!0;return!1}};class n{constructor(t,i,e){this.x=t,this.y=i,this.z=e,this.w=1}static Add(t,i){return new n(t.x+i.x,t.y+i.y,t.z+i.z)}static Subtract(t,i){return new n(t.x-i.x,t.y-i.y,t.z-i.z)}static Multiply(t,i){return new n(t.x*i,t.y*i,t.z*i)}static Divide(t,i){return new n(t.x/i,t.y/i,t.z/i)}static Dot(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}static Length(t){return Math.sqrt(n.Dot(t,t))}static Normalize(t){var i=n.Length(t);return new n(t.x/i,t.y/i,t.z/i)}static Cross(t,i){return new n(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)}static MultiplyWithMatrix(t,i){var e=new n(0,0,0);return e.x=t.x*i[0][0]+t.y*i[1][0]+t.z*i[2][0]+t.w*i[3][0],e.y=t.x*i[0][1]+t.y*i[1][1]+t.z*i[2][1]+t.w*i[3][1],e.z=t.x*i[0][2]+t.y*i[1][2]+t.z*i[2][2]+t.w*i[3][2],e.w=t.x*i[0][3]+t.y*i[1][3]+t.z*i[2][3]+t.w*i[3][3],e}static IntersectPlane(t,i,e,r){i=n.Normalize(i);var a=-n.Dot(i,t),s=n.Dot(e,i),o=(-a-s)/(n.Dot(r,i)-s),h=n.Subtract(r,e),l=n.Multiply(h,o);return n.Add(e,l)}static Print(t,i=\"Vector\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}pixelAlign(t){return this.x=a.RoundToPixelGrid(this.x,t),this.y=a.RoundToPixelGrid(this.y,t),this.z=a.RoundToPixelGrid(this.z,t),this}}class s{static Make(t){for(var i=[],e=0;e<t[0];++e)i.push(1==t.length?0:s.Make(t.slice(1)));return i}static Identity(){var t=s.Make([4,4]);return t[0][0]=1,t[1][1]=1,t[2][2]=1,t[3][3]=1,t}static Translation(t){var i=s.Identity();return i[3][0]=t.x,i[3][1]=t.y,i[3][2]=t.z,i}static Scale(t){var i=s.Identity();return i[0][0]=t.x,i[1][1]=t.y,i[2][2]=t.z,i}static RotationX(t){var i=s.Identity();return i[0][0]=1,i[1][1]=Math.cos(t),i[1][2]=Math.sin(t),i[2][1]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationY(t){var i=s.Identity();return i[0][0]=Math.cos(t),i[0][2]=Math.sin(t),i[1][1]=1,i[2][0]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationZ(t){var i=s.Identity();return i[0][0]=Math.cos(t),i[0][1]=Math.sin(t),i[1][0]=-Math.sin(t),i[1][1]=Math.cos(t),i[2][2]=1,i[3][3]=1,i}static Rotation(t){var i=s.Identity();return i=s.Multiply(i,s.RotationX(t.x)),i=s.Multiply(i,s.RotationY(t.y)),i=s.Multiply(i,s.RotationZ(t.z))}static Projection(t,i,e,r){var a=s.Identity();return a[0][0]=t*i,a[1][1]=i,a[2][2]=r/(r-e),a[3][2]=-r*e/(r-e),a[2][3]=1,a[3][3]=0,a}static Multiply(t,i){for(var e=s.Identity(),r=0;r<4;r++)for(var a=0;a<4;a++)e[a][r]=t[a][0]*i[0][r]+t[a][1]*i[1][r]+t[a][2]*i[2][r]+t[a][3]*i[3][r];return e}static Inverse(t){for(var i=s.Identity(),e=0;e<4;e++){var r=t[e][e];if(0==r){for(var a=e+1;a<dim;a+=1)if(0!=t[a][e]){for(n=0;n<4;n++)r=t[e][n],t[e][n]=t[a][n],t[a][n]=r,r=i[e][n],i[e][n]=i[a][n],i[a][n]=r;break}if(0==(r=t[e][e]))return s.Identity()}for(var n=0;n<4;n++)t[e][n]=t[e][n]/r,i[e][n]=i[e][n]/r;for(a=0;a<4;a++)if(a!=e){r=t[a][e];for(n=0;n<4;n++)t[a][n]-=r*t[e][n],i[a][n]-=r*i[e][n]}}return i}static LookAt(t,i,e){var r=Vector.Subtract(i,t);r=Vector.Normalize(r);var a=Vector.Multiply(r,Vector.Dot(e,r)),n=Vector.Subtract(e,a);n=Vector.Normalize(n);var o=Vector.Cross(n,r),h=s.Identity();return h[0][0]=o.x,h[0][1]=o.y,h[0][2]=o.z,h[0][3]=0,h[1][0]=n.x,h[1][1]=n.y,h[1][2]=n.z,h[1][3]=0,h[2][0]=r.x,h[2][1]=r.y,h[2][2]=r.z,h[2][3]=0,h[3][0]=t.x,h[3][1]=t.y,h[3][2]=t.z,h[3][3]=1,h}static Print(t,i=\"Matrix\"){console.log(i);for(var e=0;e<4;e++)for(var r=0;r<4;r++)console.log(\"[\"+e+\"][\"+r+\"] = \"+t[e][r])}}class o{static Print(t,i=\"Light\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}static ShadeForPercentage(t,i){return{x:255*t.x*i/255,y:255*t.y*i/255,z:255*t.z*i/255,w:1}}static Blend(t,i,e,r,a,n,s,o){function h(t,i,e){return parseInt(t*e+i*(1-e))}function l(t,i,e){return[h(t[0],i[0],e),h(t[1],i[1],e),h(t[2],i[2],e)]}var c={x:e.x,y:e.y,z:e.z,w:1};c=r[a];for(var u=0;u<t.length;u++){var d=t[u][i[u]],g=n[u],p=Vector.Length(Vector.Subtract(g,s));if(p<o){var v=p/o,x=l([255*c.x,255*c.y,255*c.z,1],[255*d.x,255*d.y,255*c.z,1],v);c={x:x[0]/255,y:x[1]/255,z:x[2]/255,w:1}}}return c}static GetShadingIndex(t,i){var e=Math.round((i-1)*t);return e>i-1&&(e=i-1),e<0&&(e=0),e}}var h={Cube:()=>[[[0,0,0],[0,1,0],[1,1,0]],[[0,0,0],[1,1,0],[1,0,0]],[[1,0,0],[1,1,0],[1,1,1]],[[1,0,0],[1,1,1],[1,0,1]],[[1,0,1],[1,1,1],[0,1,1]],[[1,0,1],[0,1,1],[0,0,1]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,1],[0,1,0],[0,0,0]],[[0,1,0],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[1,0,1],[0,0,1],[0,0,0]],[[1,0,1],[0,0,0],[1,0,0]]]};class l{constructor(t=h.Cube(),i=new n(0,0,0),e=new n(0,0,0),r=new n(1,1,1)){this.vertices=t,this.translation=i,this.rotation=e,this.scale=r}}class c{constructor(t,i,e,r,a){this.p0=t,this.p1=i,this.p2=e,this.colorIndices=r,this.ambientIndex=a}}class u{constructor(t,i,e,r,a,n){this.p0=t,this.p1=i,this.p2=e,this.p3=r,this.colorIndices=a,this.ambientIndex=n}}class d{constructor(t,i,e,r){this.isQuad=t,this.triangle=i,this.quad=e,this.positionForLightCalculation=r}averageZ(){return this.isQuad?(this.quad.p0.z+this.quad.p1.z+this.quad.p2.z+this.quad.p3.z)/4:(this.triangle.p0.z+this.triangle.p1.z+this.triangle.p2.z)/4}colorIndices(){return this.isQuad?this.quad.colorIndices:this.triangle.colorIndices}getAmbientIndex(){return this.isQuad?this.quad.ambientIndex:this.triangle.ambientIndex}worldPositionForLighting(){return this.positionForLightCalculation}colorIndex(t){return this.colorIndices()[t]}rawPoints(){return this.isQuad?[this.quad.p0,this.quad.p1,this.quad.p2,this.quad.p3]:[this.triangle.p0,this.triangle.p1,this.triangle.p2]}setRawPoints(t){var i=this.colorIndices(),e=(this.positionForLightCalculation,this.getAmbientIndex());3==t.length?(this.isQuad=!1,this.triangle=new c(t[0],t[1],t[2],i,e)):(this.isQuad=!0,this.quad=new u(t[0],t[1],t[2],t[3],i,e))}pixelAlign(t){this.isQuad?this.setRawPoints([this.quad.p0.pixelAlign(t),this.quad.p1.pixelAlign(t),this.quad.p2.pixelAlign(t),this.quad.p3.pixelAlign(t)]):this.setRawPoints([this.triangle.p0.pixelAlign(t),this.triangle.p1.pixelAlign(t),this.triangle.p2.pixelAlign(t)])}}e.d(i,\"Engine\",function(){return g}),e.d(i,\"Model\",function(){return l});class g{constructor(t=r){this.settings=t,this.cameraNear=.1,this.cameraFar=1e3,this.cameraFOVDegrees=90,this.cameraFOV=1/Math.tan(.5*this.cameraFOVDegrees/180*3.14159),this.cameraAspectRatio=0,this.cameraPosition=new n(0,0,0),this.cameraRotation=0,this.lightColorTables=[],this.ambientLightColorTable=[],this.lightNormals=[],this.lightPositions=[],this.colorDepth=1,this.ambientLightVector,this.ambientLightNormal,this.screenSize,this.models=[]}run(t=(()=>[]),i=(()=>!1)){this.updateFn=t,this.endFn=i,this.canvas=document.getElementById(this.settings.canvasIdentifier),this.canvasContext=canvas.getContext(\"2d\"),requestAnimationFrame(this._mainEventLoop.bind(this))}_mainEventLoop(){this.endFn()||(this.models=this.updateFn(),this._update(),this._render(),requestAnimationFrame(this._mainEventLoop.bind(this)))}_update(){var t={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight};function i(t,i){for(var e=[],r=0;r<i;r++){var a=r/i;e.push(o.ShadeForPercentage(t,a))}return e}this.cameraAspectRatio=t.height/t.width,this.cameraPosition=new n(0,0,10),this.cameraRotation=0,this.cameraNear=this.settings.cameraNear,this.cameraFar=this.settings.cameraFar,this.cameraFOVDegrees=this.settings.cameraFOVDegrees,this.colorDepth=this.settings.colorDepth,this.lightColorTables=[],this.lightNormals=[],this.ambientLightVector=new n(1,0,0),this.ambientLightColorTable=i(this.ambientLightVector,this.colorDepth),this.ambientLightNormal=n.Normalize(new n(0,0,-1));for(var e=[],r=0;r<e.length;r++){var a=e[r],h=new n(a.color.X,a.color.Y,a.color.Z),l=new n(a.position.X,a.position.Y,a.position.Z);lightPositions.push(l),lightColorTables.push(i(h,this.colorDepth)),lightNormals.push(n.Normalize(l))}var g=[],p=new n(0,1,0),v=new n(0,0,1),x=s.RotationY(this.cameraRotation),y=n.MultiplyWithMatrix(v,x);v=n.Add(this.cameraPosition,y);var m=s.Inverse(s.LookAt(this.cameraPosition,v,p)),f=s.Projection(this.cameraAspectRatio,this.cameraFOV,this.cameraNear,this.cameraFar);for(r=0;r<this.models.length;r++){var w=this.models[r],z=s.Identity(),b=s.Rotation(w.rotation);z=s.Multiply(z,b);var M=s.Translation(w.translation);z=s.Multiply(z,M);var I=s.Scale(w.scale);z=s.Multiply(z,I);var C=[];for(r=0;r<w.vertices.length;++r){for(var P=w.vertices[r],S=0;S<P.length;S++){var D=new n(P[S][0],P[S][1],P[S][2]);D=n.MultiplyWithMatrix(D,z),C.push(D)}var T=[C];4==C.length&&(T=[[C[0],C[1],C[3]],[C[1],C[2],C[3]]]);for(var V=0;V<T.length;V++){C=T[V];var F=n.Subtract(C[1],C[0]),L=n.Subtract(C[2],C[0]),R=n.Normalize(n.Cross(F,L)),A=n.Subtract(C[0],this.cameraPosition);if(n.Dot(R,A)<0){for(var q=[],N=0;N<lightNormals.length;N++){var O=o.GetShadingIndex(n.Dot(R,this.lightNormals[N]));q.push(O)}var _=o.GetShadingIndex(n.Dot(R,this.ambientLightNormal));if(!this.settings.disableClipping&&0==(C=ClipVertices(new n(0,0,.1),new n(0,0,1),C)).length)continue;var j=[],Q=C[0];for(S=0;S<C.length;S++){var E=n.MultiplyWithMatrix(C[S],m);E=n.MultiplyWithMatrix(E,f),(E=n.Divide(E,E.w)).x+=1,E.x*=.5*t.width,E.y+=1,E.y*=.5*t.height,j.push(E)}4==C.length?g.push(new d(!0,{},new u(j[0],j[1],j[2],j[3],q,_),Q)):g.push(new d(!1,new c(j[0],j[1],j[2],q,_),{},Q))}}}}this.geometryToDraw=g,this.screenSize=t}_render(){this.canvasContext.fillStyle=\"#000000\",this.canvasContext.fillRect(0,0,this.screenSize.width,this.screenSize.height),geometryToDraw.sort(function(t,i){return t.averageZ()<i.averageZ()});for(var t=0;t<geometryToDraw.length;t++){var i=geometryToDraw[t],e=i.rawPoints();if(settings.disableClipping||(e=ClipVertices(new n(0,0,0),new n(0,1,0),e),e=ClipVertices(new n(0,this.screenSize.height-1,0),new n(0,-1,0),e),e=ClipVertices(new n(0,0,0),new n(1,0,0),e),0!=(e=ClipVertices(new n(this.screenSize.width-1,0,0),new n(-1,0,0),e)).length)){i.setRawPoints(e),i.pixelAlign(settings.screenScale);var r=o.Blend(this.lightColorTables,i.colorIndices(),this.ambientLightVector,this.ambientLightColorTable,i.getAmbientIndex(),this.lightPositions,i.worldPositionForLighting(),this.settings.lightDistanceThreshold);if(ctx.fillStyle=\"rgba(\"+255*r.x+\", \"+255*r.y+\", \"+255*r.z+\", \"+r.w+\");\",i.isQuad){var a=i.quad;this.canvasContext.beginPath(),this.canvasContext.moveTo(a.p0.x,a.p0.y),this.canvasContext.lineTo(a.p1.x,a.p1.y),this.canvasContext.lineTo(a.p2.x,a.p2.y),this.canvasContext.lineTo(a.p3.x,a.p3.y),this.canvasContext.closePath()}else{var s=i.triangle;this.canvasContext.beginPath(),this.canvasContext.moveTo(s.p0.x,s.p0.y),this.canvasContext.lineTo(s.p1.x,s.p1.y),this.canvasContext.lineTo(s.p2.x,s.p2.y),this.canvasContext.closePath()}}}}}}]);","extractedComments":[]}