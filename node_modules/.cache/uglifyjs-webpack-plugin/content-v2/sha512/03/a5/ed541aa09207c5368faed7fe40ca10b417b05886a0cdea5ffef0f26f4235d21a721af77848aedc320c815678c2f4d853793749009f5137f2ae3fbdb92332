{"code":"var ManiacEngine=function(t){var e={};function i(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var a in t)i.d(r,a,function(e){return t[e]}.bind(null,a));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=0)}([function(t,e,i){\"use strict\";i.r(e);var r={canvasIdentifier:\"canvas\",colorDepth:30,lightDistanceThreshold:10,screenScale:2,disableClipping:!1,cameraNear:.1,cameraFar:1e3,cameraFOVDegrees:90},a={RoundToPixelGrid:(t,e)=>Math.round(t*e)/e,IsEmpty:t=>{for(var e in t)return!0;return!1}};class n{constructor(t,e,i){this.x=t,this.y=e,this.z=i,this.w=1}static Add(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)}static Subtract(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)}static Multiply(t,e){return new n(t.x*e,t.y*e,t.z*e)}static Divide(t,e){return new n(t.x/e,t.y/e,t.z/e)}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static Length(t){return Math.sqrt(n.Dot(t,t))}static Normalize(t){var e=n.Length(t);return new n(t.x/e,t.y/e,t.z/e)}static Cross(t,e){return new n(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static MultiplyWithMatrix(t,e){var i=new n(0,0,0);return i.x=t.x*e[0][0]+t.y*e[1][0]+t.z*e[2][0]+t.w*e[3][0],i.y=t.x*e[0][1]+t.y*e[1][1]+t.z*e[2][1]+t.w*e[3][1],i.z=t.x*e[0][2]+t.y*e[1][2]+t.z*e[2][2]+t.w*e[3][2],i.w=t.x*e[0][3]+t.y*e[1][3]+t.z*e[2][3]+t.w*e[3][3],i}static IntersectPlane(t,e,i,r){e=n.Normalize(e);var a=-n.Dot(e,t),s=n.Dot(i,e),o=(-a-s)/(n.Dot(r,e)-s),h=n.Subtract(r,i),l=n.Multiply(h,o);return n.Add(i,l)}static Print(t,e=\"Vector\"){console.log(e+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}pixelAlign(t){return this.x=a.RoundToPixelGrid(this.x,t),this.y=a.RoundToPixelGrid(this.y,t),this.z=a.RoundToPixelGrid(this.z,t),this}}class s{static Make(t){for(var e=[],i=0;i<t[0];++i)e.push(1==t.length?0:s.Make(t.slice(1)));return e}static Identity(){var t=s.Make([4,4]);return t[0][0]=1,t[1][1]=1,t[2][2]=1,t[3][3]=1,t}static Translation(t){var e=s.Identity();return e[3][0]=t.x,e[3][1]=t.y,e[3][2]=t.z,e}static Scale(t){var e=s.Identity();return e[0][0]=t.x,e[1][1]=t.y,e[2][2]=t.z,e}static RotationX(t){var e=s.Identity();return e[0][0]=1,e[1][1]=Math.cos(t),e[1][2]=Math.sin(t),e[2][1]=-Math.sin(t),e[2][2]=Math.cos(t),e[3][3]=1,e}static RotationY(t){var e=s.Identity();return e[0][0]=Math.cos(t),e[0][2]=Math.sin(t),e[1][1]=1,e[2][0]=-Math.sin(t),e[2][2]=Math.cos(t),e[3][3]=1,e}static RotationZ(t){var e=s.Identity();return e[0][0]=Math.cos(t),e[0][1]=Math.sin(t),e[1][0]=-Math.sin(t),e[1][1]=Math.cos(t),e[2][2]=1,e[3][3]=1,e}static Rotation(t){var e=s.Identity();return e=s.Multiply(e,s.RotationX(t.x)),e=s.Multiply(e,s.RotationY(t.y)),e=s.Multiply(e,s.RotationZ(t.z))}static Projection(t,e,i,r){var a=s.Identity();return a[0][0]=t*e,a[1][1]=e,a[2][2]=r/(r-i),a[3][2]=-r*i/(r-i),a[2][3]=1,a[3][3]=0,a}static Multiply(t,e){for(var i=s.Identity(),r=0;r<4;r++)for(var a=0;a<4;a++)i[a][r]=t[a][0]*e[0][r]+t[a][1]*e[1][r]+t[a][2]*e[2][r]+t[a][3]*e[3][r];return i}static Inverse(t){for(var e=s.Identity(),i=0;i<4;i++){var r=t[i][i];if(0==r){for(var a=i+1;a<dim;a+=1)if(0!=t[a][i]){for(n=0;n<4;n++)r=t[i][n],t[i][n]=t[a][n],t[a][n]=r,r=e[i][n],e[i][n]=e[a][n],e[a][n]=r;break}if(0==(r=t[i][i]))return s.Identity()}for(var n=0;n<4;n++)t[i][n]=t[i][n]/r,e[i][n]=e[i][n]/r;for(a=0;a<4;a++)if(a!=i){r=t[a][i];for(n=0;n<4;n++)t[a][n]-=r*t[i][n],e[a][n]-=r*e[i][n]}}return e}static LookAt(t,e,i){var r=Vector.Subtract(e,t);r=Vector.Normalize(r);var a=Vector.Multiply(r,Vector.Dot(i,r)),n=Vector.Subtract(i,a);n=Vector.Normalize(n);var o=Vector.Cross(n,r),h=s.Identity();return h[0][0]=o.x,h[0][1]=o.y,h[0][2]=o.z,h[0][3]=0,h[1][0]=n.x,h[1][1]=n.y,h[1][2]=n.z,h[1][3]=0,h[2][0]=r.x,h[2][1]=r.y,h[2][2]=r.z,h[2][3]=0,h[3][0]=t.x,h[3][1]=t.y,h[3][2]=t.z,h[3][3]=1,h}static Print(t,e=\"Matrix\"){console.log(e);for(var i=0;i<4;i++)for(var r=0;r<4;r++)console.log(\"[\"+i+\"][\"+r+\"] = \"+t[i][r])}}class o{static Print(t,e=\"Light\"){console.log(e+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}static ShadeForPercentage(t,e){return{x:255*t.x*e/255,y:255*t.y*e/255,z:255*t.z*e/255,w:1}}static Blend(t,e,i,r,a,n,s,o){function h(t,e,i){return parseInt(t*i+e*(1-i))}function l(t,e,i){return[h(t[0],e[0],i),h(t[1],e[1],i),h(t[2],e[2],i)]}var c={x:i.x,y:i.y,z:i.z,w:1};c=r[a];for(var u=0;u<t.length;u++){var d=t[u][e[u]],g=n[u],p=Vector.Length(Vector.Subtract(g,s));if(p<o){var v=p/o,x=l([255*c.x,255*c.y,255*c.z,1],[255*d.x,255*d.y,255*c.z,1],v);c={x:x[0]/255,y:x[1]/255,z:x[2]/255,w:1}}}return c}static GetShadingIndex(t,e){var i=Math.round((e-1)*t);return i>e-1&&(i=e-1),i<0&&(i=0),i}}class h{constructor(t,e,i,r,a){this.p0=t,this.p1=e,this.p2=i,this.colorIndices=r,this.ambientIndex=a}}class l{constructor(t,e,i,r,a,n){this.p0=t,this.p1=e,this.p2=i,this.p3=r,this.colorIndices=a,this.ambientIndex=n}}class c{constructor(t,e,i,r){this.isQuad=t,this.triangle=e,this.quad=i,this.positionForLightCalculation=r}averageZ(){return this.isQuad?(this.quad.p0.z+this.quad.p1.z+this.quad.p2.z+this.quad.p3.z)/4:(this.triangle.p0.z+this.triangle.p1.z+this.triangle.p2.z)/4}colorIndices(){return this.isQuad?this.quad.colorIndices:this.triangle.colorIndices}getAmbientIndex(){return this.isQuad?this.quad.ambientIndex:this.triangle.ambientIndex}worldPositionForLighting(){return this.positionForLightCalculation}colorIndex(t){return this.colorIndices()[t]}rawPoints(){return this.isQuad?[this.quad.p0,this.quad.p1,this.quad.p2,this.quad.p3]:[this.triangle.p0,this.triangle.p1,this.triangle.p2]}setRawPoints(t){var e=this.colorIndices(),i=(this.positionForLightCalculation,this.getAmbientIndex());3==t.length?(this.isQuad=!1,this.triangle=new h(t[0],t[1],t[2],e,i)):(this.isQuad=!0,this.quad=new l(t[0],t[1],t[2],t[3],e,i))}pixelAlign(t){this.isQuad?this.setRawPoints([this.quad.p0.pixelAlign(t),this.quad.p1.pixelAlign(t),this.quad.p2.pixelAlign(t),this.quad.p3.pixelAlign(t)]):this.setRawPoints([this.triangle.p0.pixelAlign(t),this.triangle.p1.pixelAlign(t),this.triangle.p2.pixelAlign(t)])}}i.d(e,\"Engine\",function(){return u});class u{constructor(t=r){this.settings=t,this.cameraNear=.1,this.cameraFar=1e3,this.cameraFOVDegrees=90,this.cameraFOV=1/Math.tan(.5*this.cameraFOVDegrees/180*3.14159),this.cameraAspectRatio=0,this.cameraPosition=new n(0,0,0),this.cameraRotation=0,this.lightColorTables=[],this.ambientLightColorTable=[],this.lightNormals=[],this.lightPositions=[],this.colorDepth=1,this.ambientLightVector,this.ambientLightNormal,this.screenSize,this.models=[]}run(t=(()=>[]),e=(()=>!1)){this.updateFn=t,this.endFn=e,this.canvas=document.getElementById(this.settings.canvasIdentifier),this.canvasContext=canvas.getContext(\"2d\"),requestAnimationFrame(this._mainEventLoop)}_mainEventLoop(){this.endFn()||(this.models=this.updateFn(),this._update(),this._render(),requestAnimationFrame(this.EventLoop))}_update(){var t={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight};function e(t,e){for(var i=[],r=0;r<e;r++){var a=r/e;i.push(o.ShadeForPercentage(t,a))}return i}cameraAspectRatio=t.height/t.width,cameraPosition=new n(0,0,10),cameraRotation=0,cameraNear=this.settings.cameraNear,cameraFar=this.settings.cameraFar,cameraFOVDegrees=this.settings.cameraFOVDegrees,colorDepth=this.settings.colorDepth,lightColorTables=[],lightNormals=[],ambientLightVector=new n(1,0,0),ambientLightColorTable=e(ambientLightVector,colorDepth),ambientLightNormal=n.Normalize(new n(0,0,-1));for(var i=[],r=0;r<i.length;r++){var a=i[r],u=new n(a.color.X,a.color.Y,a.color.Z),d=new n(a.position.X,a.position.Y,a.position.Z);lightPositions.push(d),lightColorTables.push(e(u,colorDepth)),lightNormals.push(n.Normalize(d))}var g=[],p=new n(0,1,0),v=new n(0,0,1),x=s.RotationY(cameraRotation),y=n.MultiplyWithMatrix(v,x);v=n.Add(cameraPosition,y);var m=s.Inverse(s.LookAt(cameraPosition,v,p)),f=s.Projection(cameraAspectRatio,cameraFOV,cameraNear,cameraFar);for(r=0;r<this.models.length;r++){var w=this.models[r],z=s.Identity(),b=s.Rotation(w.rotation);z=s.Multiply(z,b);var M=s.Translation(w.translation);z=s.Multiply(z,M);var I=s.Scale(w.scale);z=s.Multiply(z,I);var P=[];for(r=0;r<w.vertices.length;++r){for(var C=w.vertices[r],S=0;S<C.length;S++){var D=new n(C[S][0],C[S][1],C[S][2]);D=n.MultiplyWithMatrix(D,z),P.push(D)}var T=[P];4==P.length&&(T=[[P[0],P[1],P[3]],[P[1],P[2],P[3]]]);for(var V=0;V<T.length;V++){P=T[V];var F=n.Subtract(P[1],P[0]),L=n.Subtract(P[2],P[0]),R=n.Normalize(n.Cross(F,L)),A=n.Subtract(P[0],cameraPosition);if(n.Dot(R,A)<0){for(var q=[],N=0;N<lightNormals.length;N++){var O=o.GetShadingIndex(n.Dot(R,lightNormals[N]));q.push(O)}var _=o.GetShadingIndex(n.Dot(R,ambientLightNormal));if(!this.settings.disableClipping&&0==(P=ClipVertices(new n(0,0,.1),new n(0,0,1),P)).length)continue;var j=[],Q=P[0];for(S=0;S<P.length;S++){var E=n.MultiplyWithMatrix(P[S],m);E=n.MultiplyWithMatrix(E,f),(E=n.Divide(E,E.w)).x+=1,E.x*=.5*t.width,E.y+=1,E.y*=.5*t.height,j.push(E)}4==P.length?g.push(new c(!0,{},new l(j[0],j[1],j[2],j[3],q,_),Q)):g.push(new c(!1,new h(j[0],j[1],j[2],q,_),{},Q))}}}}this.geometryToDraw=g,this.screenSize=t}_render(){this.canvasContext.fillStyle=\"#000000\",this.canvasContext.fillRect(0,0,this.screenSize.width,this.screenSize.height),geometryToDraw.sort(function(t,e){return t.averageZ()<e.averageZ()});for(var t=0;t<geometryToDraw.length;t++){var e=geometryToDraw[t],i=e.rawPoints();if(settings.disableClipping||(i=ClipVertices(new n(0,0,0),new n(0,1,0),i),i=ClipVertices(new n(0,this.screenSize.height-1,0),new n(0,-1,0),i),i=ClipVertices(new n(0,0,0),new n(1,0,0),i),0!=(i=ClipVertices(new n(this.screenSize.width-1,0,0),new n(-1,0,0),i)).length)){e.setRawPoints(i),e.pixelAlign(settings.screenScale);var r=o.Blend(lightColorTables,e.colorIndices(),ambientLightVector,ambientLightColorTable,e.getAmbientIndex(),lightPositions,e.worldPositionForLighting(),settings.lightDistanceThreshold);if(ctx.fillStyle=\"rgba(\"+255*r.x+\", \"+255*r.y+\", \"+255*r.z+\", \"+r.w+\");\",e.isQuad){var a=e.quad;this.canvasContext.beginPath(),this.canvasContext.moveTo(a.p0.x,a.p0.y),this.canvasContext.lineTo(a.p1.x,a.p1.y),this.canvasContext.lineTo(a.p2.x,a.p2.y),this.canvasContext.lineTo(a.p3.x,a.p3.y),this.canvasContext.closePath()}else{var s=e.triangle;this.canvasContext.beginPath(),this.canvasContext.moveTo(s.p0.x,s.p0.y),this.canvasContext.lineTo(s.p1.x,s.p1.y),this.canvasContext.lineTo(s.p2.x,s.p2.y),this.canvasContext.closePath()}}}}}}]);","extractedComments":[]}