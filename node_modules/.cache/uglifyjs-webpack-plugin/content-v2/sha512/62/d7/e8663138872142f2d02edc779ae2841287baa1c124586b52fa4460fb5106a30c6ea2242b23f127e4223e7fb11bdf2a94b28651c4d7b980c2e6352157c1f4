{"code":"var ManiacEngine=function(t){var i={};function e(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var n in t)e.d(r,n,function(i){return t[i]}.bind(null,n));return r},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,\"a\",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p=\"\",e(e.s=0)}([function(t,i,e){\"use strict\";e.r(i);var r={canvasIdentifier:\"canvas\",colorDepth:30,lightDistanceThreshold:10,screenScale:2,disableClipping:!1,cameraNear:.1,cameraFar:1e3,cameraFOVDegrees:90},n={RoundToPixelGrid:(t,i)=>Math.round(t*i)/i,IsEmpty:t=>{for(var i in t)return!0;return!1}};class a{constructor(t,i,e){this.x=t,this.y=i,this.z=e,this.w=1}static Add(t,i){return new a(t.x+i.x,t.y+i.y,t.z+i.z)}static Subtract(t,i){return new a(t.x-i.x,t.y-i.y,t.z-i.z)}static Multiply(t,i){return new a(t.x*i,t.y*i,t.z*i)}static Divide(t,i){return new a(t.x/i,t.y/i,t.z/i)}static Dot(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}static Length(t){return Math.sqrt(a.Dot(t,t))}static Normalize(t){var i=a.Length(t);return new a(t.x/i,t.y/i,t.z/i)}static Cross(t,i){return new a(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)}static MultiplyWithMatrix(t,i){var e=new a(0,0,0);return e.x=t.x*i[0][0]+t.y*i[1][0]+t.z*i[2][0]+t.w*i[3][0],e.y=t.x*i[0][1]+t.y*i[1][1]+t.z*i[2][1]+t.w*i[3][1],e.z=t.x*i[0][2]+t.y*i[1][2]+t.z*i[2][2]+t.w*i[3][2],e.w=t.x*i[0][3]+t.y*i[1][3]+t.z*i[2][3]+t.w*i[3][3],e}static IntersectPlane(t,i,e,r){i=a.Normalize(i);var n=-a.Dot(i,t),s=a.Dot(e,i),o=(-n-s)/(a.Dot(r,i)-s),h=a.Subtract(r,e),l=a.Multiply(h,o);return a.Add(e,l)}static Print(t,i=\"Vector\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}pixelAlign(t){return this.x=n.RoundToPixelGrid(this.x,t),this.y=n.RoundToPixelGrid(this.y,t),this.z=n.RoundToPixelGrid(this.z,t),this}}class s{static Make(t){for(var i=[],e=0;e<t[0];++e)i.push(1==t.length?0:s.Make(t.slice(1)));return i}static Identity(){var t=s.Make([4,4]);return t[0][0]=1,t[1][1]=1,t[2][2]=1,t[3][3]=1,t}static Translation(t){var i=s.Identity();return i[3][0]=t.x,i[3][1]=t.y,i[3][2]=t.z,i}static Scale(t){var i=s.Identity();return i[0][0]=t.x,i[1][1]=t.y,i[2][2]=t.z,i}static RotationX(t){var i=s.Identity();return i[0][0]=1,i[1][1]=Math.cos(t),i[1][2]=Math.sin(t),i[2][1]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationY(t){var i=s.Identity();return i[0][0]=Math.cos(t),i[0][2]=Math.sin(t),i[1][1]=1,i[2][0]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationZ(t){var i=s.Identity();return i[0][0]=Math.cos(t),i[0][1]=Math.sin(t),i[1][0]=-Math.sin(t),i[1][1]=Math.cos(t),i[2][2]=1,i[3][3]=1,i}static Rotation(t){var i=s.Identity();return i=s.Multiply(i,s.RotationX(t.x)),i=s.Multiply(i,s.RotationY(t.y)),i=s.Multiply(i,s.RotationZ(t.z))}static Projection(t,i,e,r){var n=s.Identity();return n[0][0]=t*i,n[1][1]=i,n[2][2]=r/(r-e),n[3][2]=-r*e/(r-e),n[2][3]=1,n[3][3]=0,n}static Multiply(t,i){for(var e=s.Identity(),r=0;r<4;r++)for(var n=0;n<4;n++)e[n][r]=t[n][0]*i[0][r]+t[n][1]*i[1][r]+t[n][2]*i[2][r]+t[n][3]*i[3][r];return e}static Inverse(t){for(var i=s.Identity(),e=0;e<4;e++){var r=t[e][e];if(0==r){for(var n=e+1;n<dim;n+=1)if(0!=t[n][e]){for(a=0;a<4;a++)r=t[e][a],t[e][a]=t[n][a],t[n][a]=r,r=i[e][a],i[e][a]=i[n][a],i[n][a]=r;break}if(0==(r=t[e][e]))return s.Identity()}for(var a=0;a<4;a++)t[e][a]=t[e][a]/r,i[e][a]=i[e][a]/r;for(n=0;n<4;n++)if(n!=e){r=t[n][e];for(a=0;a<4;a++)t[n][a]-=r*t[e][a],i[n][a]-=r*i[e][a]}}return i}static LookAt(t,i,e){var r=a.Subtract(i,t);r=a.Normalize(r);var n=a.Multiply(r,a.Dot(e,r)),o=a.Subtract(e,n);o=a.Normalize(o);var h=a.Cross(o,r),l=s.Identity();return l[0][0]=h.x,l[0][1]=h.y,l[0][2]=h.z,l[0][3]=0,l[1][0]=o.x,l[1][1]=o.y,l[1][2]=o.z,l[1][3]=0,l[2][0]=r.x,l[2][1]=r.y,l[2][2]=r.z,l[2][3]=0,l[3][0]=t.x,l[3][1]=t.y,l[3][2]=t.z,l[3][3]=1,l}static Print(t,i=\"Matrix\"){console.log(i);for(var e=0;e<4;e++)for(var r=0;r<4;r++)console.log(\"[\"+e+\"][\"+r+\"] = \"+t[e][r])}}class o{static Print(t,i=\"Light\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}static ShadeForPercentage(t,i){return{x:255*t.x*i/255,y:255*t.y*i/255,z:255*t.z*i/255,w:1}}static Blend(t,i,e,r,n,a,s,o){function h(t,i,e){return parseInt(t*e+i*(1-e))}function l(t,i,e){return[h(t[0],i[0],e),h(t[1],i[1],e),h(t[2],i[2],e)]}var c={x:e.x,y:e.y,z:e.z,w:1};c=r[n];for(var u=0;u<t.length;u++){var d=t[u][i[u]],g=a[u],p=Vector.Length(Vector.Subtract(g,s));if(p<o){var v=p/o,x=l([255*c.x,255*c.y,255*c.z,1],[255*d.x,255*d.y,255*c.z,1],v);c={x:x[0]/255,y:x[1]/255,z:x[2]/255,w:1}}}return c}static GetShadingIndex(t,i){var e=Math.round((i-1)*t);return e>i-1&&(e=i-1),e<0&&(e=0),e}}var h={Cube:()=>[[[0,0,0],[0,1,0],[1,1,0]],[[0,0,0],[1,1,0],[1,0,0]],[[1,0,0],[1,1,0],[1,1,1]],[[1,0,0],[1,1,1],[1,0,1]],[[1,0,1],[1,1,1],[0,1,1]],[[1,0,1],[0,1,1],[0,0,1]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,1],[0,1,0],[0,0,0]],[[0,1,0],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[1,0,1],[0,0,1],[0,0,0]],[[1,0,1],[0,0,0],[1,0,0]]]};class l{constructor(t=h.Cube(),i=new a(0,0,5),e=new a(0,0,0),r=new a(1,1,1)){this.vertices=t,this.translation=i,this.rotation=e,this.scale=r}}class c{constructor(t,i,e,r,n){this.p0=t,this.p1=i,this.p2=e,this.colorIndices=r,this.ambientIndex=n}}class u{constructor(t,i,e,r,n,a){this.p0=t,this.p1=i,this.p2=e,this.p3=r,this.colorIndices=n,this.ambientIndex=a}}class d{constructor(t,i,e,r){this.isQuad=t,this.triangle=i,this.quad=e,this.positionForLightCalculation=r}averageZ(){return this.isQuad?(this.quad.p0.z+this.quad.p1.z+this.quad.p2.z+this.quad.p3.z)/4:(this.triangle.p0.z+this.triangle.p1.z+this.triangle.p2.z)/4}colorIndices(){return this.isQuad?this.quad.colorIndices:this.triangle.colorIndices}getAmbientIndex(){return this.isQuad?this.quad.ambientIndex:this.triangle.ambientIndex}worldPositionForLighting(){return this.positionForLightCalculation}colorIndex(t){return this.colorIndices()[t]}rawPoints(){return this.isQuad?[this.quad.p0,this.quad.p1,this.quad.p2,this.quad.p3]:[this.triangle.p0,this.triangle.p1,this.triangle.p2]}setRawPoints(t){var i=this.colorIndices(),e=(this.positionForLightCalculation,this.getAmbientIndex());3==t.length?(this.isQuad=!1,this.triangle=new c(t[0],t[1],t[2],i,e)):(this.isQuad=!0,this.quad=new u(t[0],t[1],t[2],t[3],i,e))}pixelAlign(t){this.isQuad?this.setRawPoints([this.quad.p0.pixelAlign(t),this.quad.p1.pixelAlign(t),this.quad.p2.pixelAlign(t),this.quad.p3.pixelAlign(t)]):this.setRawPoints([this.triangle.p0.pixelAlign(t),this.triangle.p1.pixelAlign(t),this.triangle.p2.pixelAlign(t)])}}e.d(i,\"Engine\",function(){return g}),e.d(i,\"Model\",function(){return l}),e.d(i,\"Vector\",function(){return a});class g{constructor(t=r){this.settings=t,this.cameraNear=.1,this.cameraFar=1e3,this.cameraFOVDegrees=90,this.cameraFOV=1/Math.tan(.5*this.cameraFOVDegrees/180*3.14159),this.cameraAspectRatio=0,this.cameraPosition=new a(0,0,0),this.cameraRotation=0,this.lightColorTables=[],this.ambientLightColorTable=[],this.lightNormals=[],this.lightPositions=[],this.colorDepth=1,this.ambientLightVector,this.ambientLightNormal,this.screenSize,this.models=[]}run(t=(()=>[]),i=(()=>!1)){this.updateFn=t,this.endFn=i,this.canvas=document.getElementById(this.settings.canvasIdentifier),this.canvasContext=canvas.getContext(\"2d\"),requestAnimationFrame(this._mainEventLoop.bind(this))}_mainEventLoop(){this.endFn()||(this.models=this.updateFn(),this._update(),this._render(),requestAnimationFrame(this._mainEventLoop.bind(this)))}_update(){var t={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight};function i(t,i){for(var e=[],r=0;r<i;r++){var n=r/i;e.push(o.ShadeForPercentage(t,n))}return e}this.cameraAspectRatio=t.height/t.width,this.cameraPosition=new a(0,0,10),this.cameraRotation=0,this.cameraNear=this.settings.cameraNear,this.cameraFar=this.settings.cameraFar,this.cameraFOVDegrees=this.settings.cameraFOVDegrees,this.colorDepth=this.settings.colorDepth,this.lightColorTables=[],this.lightNormals=[],this.ambientLightVector=new a(1,0,0),this.ambientLightColorTable=i(this.ambientLightVector,this.colorDepth),this.ambientLightNormal=a.Normalize(new a(0,0,-1));for(var e=[],r=0;r<e.length;r++){var n=e[r],h=new a(n.color.X,n.color.Y,n.color.Z),l=new a(n.position.X,n.position.Y,n.position.Z);lightPositions.push(l),lightColorTables.push(i(h,this.colorDepth)),lightNormals.push(a.Normalize(l))}var g=[],p=new a(0,1,0),v=new a(0,0,1),x=s.RotationY(this.cameraRotation),y=a.MultiplyWithMatrix(v,x);v=a.Add(this.cameraPosition,y);var m=s.Inverse(s.LookAt(this.cameraPosition,v,p)),f=s.Projection(this.cameraAspectRatio,this.cameraFOV,this.cameraNear,this.cameraFar);for(r=0;r<this.models.length;r++){var w=this.models[r],z=s.Identity(),b=s.Rotation(w.rotation);z=s.Multiply(z,b);var M=s.Translation(w.translation);z=s.Multiply(z,M);var I=s.Scale(w.scale);z=s.Multiply(z,I);var C=[];for(r=0;r<w.vertices.length;++r){for(var P=w.vertices[r],S=0;S<P.length;S++){var D=new a(P[S][0],P[S][1],P[S][2]);D=a.MultiplyWithMatrix(D,z),C.push(D)}var T=[C];4==C.length&&(T=[[C[0],C[1],C[3]],[C[1],C[2],C[3]]]);for(var F=0;F<T.length;F++){C=T[F];var R=a.Subtract(C[1],C[0]),L=a.Subtract(C[2],C[0]),A=a.Normalize(a.Cross(R,L)),q=a.Subtract(C[0],this.cameraPosition);if(a.Dot(A,q)<0){for(var N=[],V=0;V<lightNormals.length;V++){var O=o.GetShadingIndex(a.Dot(A,this.lightNormals[V]));N.push(O)}var _=o.GetShadingIndex(a.Dot(A,this.ambientLightNormal));if(!this.settings.disableClipping&&0==(C=ClipVertices(new a(0,0,.1),new a(0,0,1),C)).length)continue;var j=[],Q=C[0];for(S=0;S<C.length;S++){var E=a.MultiplyWithMatrix(C[S],m);E=a.MultiplyWithMatrix(E,f),(E=a.Divide(E,E.w)).x+=1,E.x*=.5*t.width,E.y+=1,E.y*=.5*t.height,j.push(E)}4==C.length?g.push(new d(!0,{},new u(j[0],j[1],j[2],j[3],N,_),Q)):g.push(new d(!1,new c(j[0],j[1],j[2],N,_),{},Q))}}}}this.geometryToDraw=g,this.screenSize=t}_render(){this.canvasContext.fillStyle=\"#000000\",this.canvasContext.fillRect(0,0,this.screenSize.width,this.screenSize.height),this.geometryToDraw.sort(function(t,i){return t.averageZ()<i.averageZ()}),console.log(\"Rendering: \"+this.geometryToDraw.length+\" geometries\");for(var t=0;t<this.geometryToDraw.length;t++){var i=this.geometryToDraw[t],e=i.rawPoints();if(settings.disableClipping||(e=ClipVertices(new a(0,0,0),new a(0,1,0),e),e=ClipVertices(new a(0,this.screenSize.height-1,0),new a(0,-1,0),e),e=ClipVertices(new a(0,0,0),new a(1,0,0),e),0!=(e=ClipVertices(new a(this.screenSize.width-1,0,0),new a(-1,0,0),e)).length)){i.setRawPoints(e),i.pixelAlign(settings.screenScale);var r=o.Blend(this.lightColorTables,i.colorIndices(),this.ambientLightVector,this.ambientLightColorTable,i.getAmbientIndex(),this.lightPositions,i.worldPositionForLighting(),this.settings.lightDistanceThreshold);if(ctx.fillStyle=\"rgba(\"+255*r.x+\", \"+255*r.y+\", \"+255*r.z+\", \"+r.w+\");\",i.isQuad){var n=i.quad;this.canvasContext.beginPath(),this.canvasContext.moveTo(n.p0.x,n.p0.y),this.canvasContext.lineTo(n.p1.x,n.p1.y),this.canvasContext.lineTo(n.p2.x,n.p2.y),this.canvasContext.lineTo(n.p3.x,n.p3.y),this.canvasContext.closePath()}else{var s=i.triangle;this.canvasContext.beginPath(),this.canvasContext.moveTo(s.p0.x,s.p0.y),this.canvasContext.lineTo(s.p1.x,s.p1.y),this.canvasContext.lineTo(s.p2.x,s.p2.y),this.canvasContext.closePath()}}}}}}]);","extractedComments":[]}