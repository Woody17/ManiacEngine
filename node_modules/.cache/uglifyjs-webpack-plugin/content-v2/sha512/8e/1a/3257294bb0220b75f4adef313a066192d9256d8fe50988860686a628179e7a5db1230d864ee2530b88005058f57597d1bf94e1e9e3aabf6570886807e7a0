{"code":"var ManiacEngine=function(t){var i={};function e(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var n in t)e.d(r,n,function(i){return t[i]}.bind(null,n));return r},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,\"a\",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p=\"\",e(e.s=0)}([function(t,i,e){\"use strict\";e.r(i);var r={canvasIdentifier:\"canvas\",colorDepth:30,lightDistanceThreshold:10,screenScale:2,disableClipping:!1,cameraNear:.1,cameraFar:1e3,cameraFOVDegrees:90},n={RoundToPixelGrid:(t,i)=>Math.round(t*i)/i,IsEmpty:t=>{for(var i in t)return!0;return!1}};class s{constructor(t,i,e){this.x=t,this.y=i,this.z=e,this.w=1}static Add(t,i){return new s(t.x+i.x,t.y+i.y,t.z+i.z)}static Subtract(t,i){return new s(t.x-i.x,t.y-i.y,t.z-i.z)}static Multiply(t,i){return new s(t.x*i,t.y*i,t.z*i)}static Divide(t,i){return new s(t.x/i,t.y/i,t.z/i)}static Dot(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}static Length(t){return Math.sqrt(s.Dot(t,t))}static Normalize(t){var i=s.Length(t);return new s(t.x/i,t.y/i,t.z/i)}static Cross(t,i){return new s(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)}static MultiplyWithMatrix(t,i){var e=new s(0,0,0);return e.x=t.x*i[0][0]+t.y*i[1][0]+t.z*i[2][0]+t.w*i[3][0],e.y=t.x*i[0][1]+t.y*i[1][1]+t.z*i[2][1]+t.w*i[3][1],e.z=t.x*i[0][2]+t.y*i[1][2]+t.z*i[2][2]+t.w*i[3][2],e.w=t.x*i[0][3]+t.y*i[1][3]+t.z*i[2][3]+t.w*i[3][3],e}static IntersectPlane(t,i,e,r){i=s.Normalize(i);var n=-s.Dot(i,t),a=s.Dot(e,i),o=(-n-a)/(s.Dot(r,i)-a),h=s.Subtract(r,e),l=s.Multiply(h,o);return s.Add(e,l)}static Print(t,i=\"Vector\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}pixelAlign(t){return this.x=n.RoundToPixelGrid(this.x,t),this.y=n.RoundToPixelGrid(this.y,t),this.z=n.RoundToPixelGrid(this.z,t),this}}class a{static Make(t){for(var i=[],e=0;e<t[0];++e)i.push(1==t.length?0:a.Make(t.slice(1)));return i}static Identity(){var t=a.Make([4,4]);return t[0][0]=1,t[1][1]=1,t[2][2]=1,t[3][3]=1,t}static Translation(t){var i=a.Identity();return i[3][0]=t.x,i[3][1]=t.y,i[3][2]=t.z,i}static Scale(t){var i=a.Identity();return i[0][0]=t.x,i[1][1]=t.y,i[2][2]=t.z,i}static RotationX(t){var i=a.Identity();return i[0][0]=1,i[1][1]=Math.cos(t),i[1][2]=Math.sin(t),i[2][1]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationY(t){var i=a.Identity();return i[0][0]=Math.cos(t),i[0][2]=Math.sin(t),i[1][1]=1,i[2][0]=-Math.sin(t),i[2][2]=Math.cos(t),i[3][3]=1,i}static RotationZ(t){var i=a.Identity();return i[0][0]=Math.cos(t),i[0][1]=Math.sin(t),i[1][0]=-Math.sin(t),i[1][1]=Math.cos(t),i[2][2]=1,i[3][3]=1,i}static Rotation(t){var i=a.Identity();return i=a.Multiply(i,a.RotationX(t.x)),i=a.Multiply(i,a.RotationY(t.y)),i=a.Multiply(i,a.RotationZ(t.z))}static Projection(t,i,e,r){var n=a.Identity();return n[0][0]=t*i,n[1][1]=i,n[2][2]=r/(r-e),n[3][2]=-r*e/(r-e),n[2][3]=1,n[3][3]=0,n}static Multiply(t,i){for(var e=a.Identity(),r=0;r<4;r++)for(var n=0;n<4;n++)e[n][r]=t[n][0]*i[0][r]+t[n][1]*i[1][r]+t[n][2]*i[2][r]+t[n][3]*i[3][r];return e}static Inverse(t){for(var i=a.Identity(),e=0;e<4;e++){var r=t[e][e];if(0==r){for(var n=e+1;n<dim;n+=1)if(0!=t[n][e]){for(s=0;s<4;s++)r=t[e][s],t[e][s]=t[n][s],t[n][s]=r,r=i[e][s],i[e][s]=i[n][s],i[n][s]=r;break}if(0==(r=t[e][e]))return a.Identity()}for(var s=0;s<4;s++)t[e][s]=t[e][s]/r,i[e][s]=i[e][s]/r;for(n=0;n<4;n++)if(n!=e){r=t[n][e];for(s=0;s<4;s++)t[n][s]-=r*t[e][s],i[n][s]-=r*i[e][s]}}return i}static LookAt(t,i,e){var r=s.Subtract(i,t);r=s.Normalize(r);var n=s.Multiply(r,s.Dot(e,r)),o=s.Subtract(e,n);o=s.Normalize(o);var h=s.Cross(o,r),l=a.Identity();return l[0][0]=h.x,l[0][1]=h.y,l[0][2]=h.z,l[0][3]=0,l[1][0]=o.x,l[1][1]=o.y,l[1][2]=o.z,l[1][3]=0,l[2][0]=r.x,l[2][1]=r.y,l[2][2]=r.z,l[2][3]=0,l[3][0]=t.x,l[3][1]=t.y,l[3][2]=t.z,l[3][3]=1,l}static Print(t,i=\"Matrix\"){console.log(i);for(var e=0;e<4;e++)for(var r=0;r<4;r++)console.log(\"[\"+e+\"][\"+r+\"] = \"+t[e][r])}}class o{static Print(t,i=\"Light\"){console.log(i+\": x: \"+t.x+\" y: \"+t.y+\" z:\"+t.z)}static ShadeForPercentage(t,i){return{x:255*t.x*i/255,y:255*t.y*i/255,z:255*t.z*i/255,w:1}}static Blend(t,i,e,r,n,s,a,o){function h(t,i,e){return parseInt(t*e+i*(1-e))}function l(t,i,e){return[h(t[0],i[0],e),h(t[1],i[1],e),h(t[2],i[2],e)]}var c={x:e.x,y:e.y,z:e.z,w:1};c=r[n];for(var u=0;u<t.length;u++){var g=t[u][i[u]],d=s[u],p=Vector.Length(Vector.Subtract(d,a));if(p<o){var v=p/o,y=l([255*c.x,255*c.y,255*c.z,1],[255*g.x,255*g.y,255*c.z,1],v);c={x:y[0]/255,y:y[1]/255,z:y[2]/255,w:1}}}return c}static GetShadingIndex(t,i){var e=Math.round((i-1)*t);return e>i-1&&(e=i-1),e<0&&(e=0),e}}var h={Cube:()=>[[[0,0,0],[0,1,0],[1,1,0]],[[0,0,0],[1,1,0],[1,0,0]],[[1,0,0],[1,1,0],[1,1,1]],[[1,0,0],[1,1,1],[1,0,1]],[[1,0,1],[1,1,1],[0,1,1]],[[1,0,1],[0,1,1],[0,0,1]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,1],[0,1,0],[0,0,0]],[[0,1,0],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[1,0,1],[0,0,1],[0,0,0]],[[1,0,1],[0,0,0],[1,0,0]]]};class l{constructor(t=h.Cube(),i=new s(0,0,5),e=new s(0,0,0),r=new s(1,1,1)){this.vertices=t,this.translation=i,this.rotation=e,this.scale=r}}class c{constructor(t,i,e,r,n){this.p0=t,this.p1=i,this.p2=e,this.colorIndices=r,this.ambientIndex=n}}class u{constructor(t,i,e,r,n,s){this.p0=t,this.p1=i,this.p2=e,this.p3=r,this.colorIndices=n,this.ambientIndex=s}}class g{constructor(t,i,e,r){this.isQuad=t,this.triangle=i,this.quad=e,this.positionForLightCalculation=r}averageZ(){return this.isQuad?(this.quad.p0.z+this.quad.p1.z+this.quad.p2.z+this.quad.p3.z)/4:(this.triangle.p0.z+this.triangle.p1.z+this.triangle.p2.z)/4}colorIndices(){return this.isQuad?this.quad.colorIndices:this.triangle.colorIndices}getAmbientIndex(){return this.isQuad?this.quad.ambientIndex:this.triangle.ambientIndex}worldPositionForLighting(){return this.positionForLightCalculation}colorIndex(t){return this.colorIndices()[t]}rawPoints(){return this.isQuad?[this.quad.p0,this.quad.p1,this.quad.p2,this.quad.p3]:[this.triangle.p0,this.triangle.p1,this.triangle.p2]}setRawPoints(t){var i=this.colorIndices(),e=(this.positionForLightCalculation,this.getAmbientIndex());3==t.length?(this.isQuad=!1,this.triangle=new c(t[0],t[1],t[2],i,e)):(this.isQuad=!0,this.quad=new u(t[0],t[1],t[2],t[3],i,e))}pixelAlign(t){this.isQuad?this.setRawPoints([this.quad.p0.pixelAlign(t),this.quad.p1.pixelAlign(t),this.quad.p2.pixelAlign(t),this.quad.p3.pixelAlign(t)]):this.setRawPoints([this.triangle.p0.pixelAlign(t),this.triangle.p1.pixelAlign(t),this.triangle.p2.pixelAlign(t)])}}var d={ClipVertices:(t,i,e)=>{function r(t,i,e){return e.x*t.x+e.y*t.y+e.z*t.z-s.Dot(e,i)}if(i=s.Normalize(i),0==e.length)return[];for(var n=[],a=!0,o=!0,h=[],l=[],c=0;c<e.length;c++){var u=e[c];r(u,t,i)>=0?(o=!1,n.push({inside:!0,point:u}),h.push(u)):(a=!1,n.push({inside:!1,point:u}),l.push(u))}return a?e:o?[]:(3==e.length&&1==l.length&&(e=[h[0],h[1],s.IntersectPlane(t,i,h[1],l[0]),s.IntersectPlane(t,i,h[0],l[0])]),3==e.length&&2==l.length&&(e=[h[0],s.IntersectPlane(t,i,h[0],l[0]),s.IntersectPlane(t,i,h[0],l[1])]),e)}};e.d(i,\"Engine\",function(){return p}),e.d(i,\"Model\",function(){return l}),e.d(i,\"Vector\",function(){return s});class p{constructor(t=r){this.settings=t,this.cameraNear=.1,this.cameraFar=1e3,this.cameraFOVDegrees=90,this.cameraFOV=1/Math.tan(.5*this.cameraFOVDegrees/180*3.14159),this.cameraAspectRatio=0,this.cameraPosition=new s(0,0,0),this.cameraRotation=0,this.lightColorTables=[],this.ambientLightColorTable=[],this.lightNormals=[],this.lightPositions=[],this.colorDepth=1,this.ambientLightVector,this.ambientLightNormal,this.screenSize,this.models=[]}run(t=(()=>[]),i=(()=>!1)){this.updateFn=t,this.endFn=i,requestAnimationFrame(this._mainEventLoop.bind(this))}_mainEventLoop(){this.endFn()||(this.models=this.updateFn(),this._update(),this._render(),requestAnimationFrame(this._mainEventLoop.bind(this)))}_update(){this.canvas=document.getElementById(this.settings.canvasIdentifier),this.canvasContext=canvas.getContext(\"2d\");var t={width:this.canvas.clientWidth,height:this.canvas.clientHeight};function i(t,i){for(var e=[],r=0;r<i;r++){var n=r/i;e.push(o.ShadeForPercentage(t,n))}return e}this.cameraAspectRatio=t.height/t.width,this.cameraPosition=new s(0,-1,1),this.cameraRotation=0,this.cameraNear=this.settings.cameraNear,this.cameraFar=this.settings.cameraFar,this.cameraFOVDegrees=this.settings.cameraFOVDegrees,this.colorDepth=this.settings.colorDepth,this.lightColorTables=[],this.lightNormals=[],this.ambientLightVector=new s(1,0,0),this.ambientLightColorTable=i(this.ambientLightVector,this.colorDepth),this.ambientLightNormal=s.Normalize(new s(0,0,-1));for(var e=[],r=0;r<e.length;r++){var n=e[r],h=new s(n.color.X,n.color.Y,n.color.Z),l=new s(n.position.X,n.position.Y,n.position.Z);this.lightPositions.push(l),this.lightColorTables.push(i(h,this.colorDepth)),this.lightNormals.push(s.Normalize(l))}var p=[],v=new s(0,1,0),y=new s(0,0,1),x=a.RotationY(this.cameraRotation),m=s.MultiplyWithMatrix(y,x);y=s.Add(this.cameraPosition,m);var f=a.Inverse(a.LookAt(this.cameraPosition,y,v)),w=a.Projection(this.cameraAspectRatio,this.cameraFOV,this.cameraNear,this.cameraFar);for(r=0;r<this.models.length;r++){var z=this.models[r],b=a.Identity(),M=a.Rotation(z.rotation);b=a.Multiply(b,M);var I=a.Translation(z.translation);b=a.Multiply(b,I);var P=a.Scale(z.scale);b=a.Multiply(b,P);var C=[];for(r=0;r<z.vertices.length;++r){for(var S=z.vertices[r],D=0;D<S.length;D++){var T=new s(S[D][0],S[D][1],S[D][2]);T=s.MultiplyWithMatrix(T,b),C.push(T)}var F=[C];4==C.length&&(F=[[C[0],C[1],C[3]],[C[1],C[2],C[3]]]);for(var R=0;R<F.length;R++){C=F[R];var L=s.Subtract(C[1],C[0]),A=s.Subtract(C[2],C[0]),N=s.Normalize(s.Cross(L,A)),V=s.Subtract(C[0],this.cameraPosition);if(s.Dot(N,V)<0){for(var q=[],O=0;O<this.lightNormals.length;O++){var _=o.GetShadingIndex(s.Dot(N,this.lightNormals[O]));q.push(_)}var j=o.GetShadingIndex(s.Dot(N,this.ambientLightNormal));if(!this.settings.disableClipping&&0==(C=d.ClipVertices(new s(0,0,.1),new s(0,0,1),C)).length)continue;var Q=[],E=C[0];for(D=0;D<C.length;D++){var G=s.MultiplyWithMatrix(C[D],f);G=s.MultiplyWithMatrix(G,w),(G=s.Divide(G,G.w)).x+=1,G.x*=.5*t.width,G.y+=1,G.y*=.5*t.height,Q.push(G)}4==C.length?p.push(new g(!0,{},new u(Q[0],Q[1],Q[2],Q[3],q,j),E)):p.push(new g(!1,new c(Q[0],Q[1],Q[2],q,j),{},E))}}}}this.geometryToDraw=p,this.screenSize=t}_render(){this.canvasContext.fillStyle=\"#000000\",this.canvasContext.fillRect(0,0,this.screenSize.width,this.screenSize.height),this.geometryToDraw.sort(function(t,i){return t.averageZ()<i.averageZ()}),console.log(\"Rendering: \"+this.geometryToDraw.length+\" geometries\"),console.log(\"Screen Size: \"+JSON.stringify(this.screenSize));for(var t=0;t<this.geometryToDraw.length;t++){var i=this.geometryToDraw[t],e=i.rawPoints();if(this.settings.disableClipping||(e=d.ClipVertices(new s(0,0,0),new s(0,1,0),e),e=d.ClipVertices(new s(0,this.screenSize.height-1,0),new s(0,-1,0),e),e=d.ClipVertices(new s(0,0,0),new s(1,0,0),e),0!=(e=d.ClipVertices(new s(this.screenSize.width-1,0,0),new s(-1,0,0),e)).length)){i.setRawPoints(e),i.pixelAlign(this.settings.screenScale);o.Blend(this.lightColorTables,i.colorIndices(),this.ambientLightVector,this.ambientLightColorTable,i.getAmbientIndex(),this.lightPositions,i.worldPositionForLighting(),this.settings.lightDistanceThreshold);if(this.canvasContext.fillStyle=\"#FF0000\",i.isQuad){var r=i.quad;this.canvasContext.beginPath(),this.canvasContext.moveTo(r.p0.x,r.p0.y),this.canvasContext.lineTo(r.p1.x,r.p1.y),this.canvasContext.lineTo(r.p2.x,r.p2.y),this.canvasContext.lineTo(r.p3.x,r.p3.y),this.canvasContext.closePath()}else{var n=i.triangle,a=new Path2D;a.moveTo(n.p0.x,n.p0.y),a.lineTo(n.p1.x,n.p1.y),a.lineTo(n.p2.x,n.p2.y),this.canvasContext.fill(a)}}}}}}]);","extractedComments":[]}